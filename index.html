<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>DV CÃ¼zdan</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00ff66">

<style>
body{
 margin:0;
 font-family:Segoe UI,Arial;
 background:linear-gradient(160deg,#0b0b0b,#121212);
 color:white
}
.hidden{display:none}
header{
 text-align:center;
 padding:20px 10px;
 font-size:34px;
 font-weight:bold
}
.d{color:#00ff66}.v{color:orange}

.container{max-width:480px;margin:auto}
.card{
 background:#181818;
 margin:15px;
 padding:15px;
 border-radius:16px;
 box-shadow:0 5px 20px rgba(0,0,0,.4)
}

h3{margin:5px 0 10px 0}

input,button{
 width:100%;
 padding:12px;
 margin-top:8px;
 border-radius:10px;
 border:none;
 font-size:16px
}

button{background:#00aa55;color:white}
.red{background:#cc3333}
.orange{background:orange;color:black}
.blue{background:#3399ff}

.balance{
 text-align:center;
 font-size:34px;
 margin:10px 0
}

.tx{
 border-bottom:1px solid #333;
 padding:8px 0;
 font-size:14px
}

.stat{
 display:flex;
 justify-content:space-between;
 padding:6px 0;
 font-size:14px
}

small{opacity:.7}
</style>
</head>

<body>

<header>
 <span class="d">D</span><span class="v">V</span> CÃ¼zdan
</header>

<div class="container">

<!-- AUTH -->
<div id="auth" class="card">
 <h3>ğŸ” GiriÅŸ / KayÄ±t</h3>
 <input id="user" placeholder="KullanÄ±cÄ± adÄ±">
 <input id="pass" type="password" placeholder="Åifre">
 <input id="pin" type="password" placeholder="PIN (4 hane)">
 <button onclick="login()">GiriÅŸ / KayÄ±t</button>
</div>

<!-- WALLET -->
<div id="wallet" class="hidden">

<div class="card">
 <div class="balance" id="bal">0 DV</div>
</div>

<div class="card">
 <input id="amt" type="number" placeholder="DV miktarÄ±">
 <button onclick="add()">â• Ekle</button>
 <button class="red" onclick="sub()">â– Ã‡Ä±kar</button>
 <button class="red" onclick="withdraw()">ğŸ’¸ Para Ã‡ek</button>
</div>

<div class="card">
 <h3>ğŸ“¤ DV GÃ¶nder</h3>
 <input id="to" placeholder="AlÄ±cÄ± kullanÄ±cÄ±">
 <input id="send" type="number" placeholder="DV miktarÄ±">
 <button class="orange" onclick="transfer()">GÃ¶nder</button>
</div>

<div class="card">
 <h3>ğŸ”³ QR Kod</h3>
 <div id="qr"></div>
 <button onclick="makeQR()">QR OluÅŸtur</button>
</div>

<div class="card">
 <h3>ğŸ“œ Ä°ÅŸlem GeÃ§miÅŸi</h3>
 <div id="log"></div>
</div>

<!-- ADMIN -->
<div id="adminBox" class="card hidden">
 <h3>ğŸ‘‘ Admin Panel</h3>

 <input id="mintUser" placeholder="KullanÄ±cÄ± adÄ±">
 <input id="mintAmount" type="number" placeholder="BasÄ±lacak DV">
 <button class="blue" onclick="mint()">ğŸ’° Para Bas</button>

 <h3>ğŸ“Š Ä°statistikler</h3>
 <div id="stats"></div>
</div>

<div class="card">
 <button onclick="logout()" class="red">Ã‡Ä±kÄ±ÅŸ</button>
</div>

</div>
</div>

<script src="qrcode.min.js"></script>
<script>
if("serviceWorker"in navigator){
 navigator.serviceWorker.register("sw.js");
}

let users=JSON.parse(localStorage.getItem("dv_users"))||{};
let current=null;

/* LOGIN */
function login(){
 let u=user.value,p=pass.value,pi=pin.value;
 if(!u||!p||pi.length<4) return alert("Eksik bilgi");

 if(!users[u]){
   users[u]={pass:p,pin:pi,balance:0,chain:[],isAdmin:false};
 }else{
   if(users[u].pass!==p||users[u].pin!==pi)
     return alert("HatalÄ± bilgi");
 }

 if(u==="admin"&&p==="DV-ADMIN"){
   users[u].isAdmin=true;
   users[u].balance=Infinity;
 }

 current=u;
 save();
 auth.classList.add("hidden");
 wallet.classList.remove("hidden");
 if(users[current].isAdmin) adminBox.classList.remove("hidden");
 render();
}

/* WALLET */
function add(){
 let a=+amt.value;if(a<=0)return;
 if(!users[current].isAdmin) users[current].balance+=a;
 block("â• Eklendi",a);
}
function sub(){
 let a=+amt.value;if(a<=0)return;
 if(!users[current].isAdmin&&a>users[current].balance)
  return alert("Yetersiz");
 if(!users[current].isAdmin) users[current].balance-=a;
 block("â– Ã‡Ä±karÄ±ldÄ±",a);
}
function withdraw(){
 if(users[current].isAdmin) return alert("Admin âˆ bakiye");
 let a=prompt("Ã‡ekilecek DV:");
 a=parseFloat(a);
 if(!a||a>users[current].balance) return;
 users[current].balance-=a;
 block("ğŸ’¸ Ã‡ekildi",a);
}
function transfer(){
 let t=to.value,a=+send.value;
 if(!users[t]||!a) return alert("HatalÄ±");
 if(!users[current].isAdmin&&a>users[current].balance)
  return alert("Yetersiz");
 if(!users[current].isAdmin) users[current].balance-=a;
 users[t].balance+=a;
 block("ğŸ“¤ GÃ¶nderildi â†’ "+t,a);
}

/* ADMIN */
function mint(){
 let u=mintUser.value,a=+mintAmount.value;
 if(!users[u]||a<=0) return alert("HatalÄ±");
 users[u].balance+=a;
 block("ğŸ‘‘ Admin Para BastÄ± â†’ "+u,a);
 save(); render();
}

/* QR */
function makeQR(){
 qr.innerHTML="";
 new QRCode(qr,{
  text:JSON.stringify({from:current}),
  width:150,height:150
 });
}

/* BLOCKCHAIN */
function block(type,amt){
 let c=users[current].chain;
 let prev=c.length?c[c.length-1].hash:"GENESIS";
 let hash=btoa(type+amt+Date.now()).slice(0,20);
 c.push({type,amt,prev,hash,time:new Date().toLocaleString()});
 save(); render();
}

/* UI */
function render(){
 bal.innerText = users[current].isAdmin ? "âˆ DV" : users[current].balance+" DV";

 log.innerHTML=users[current].chain.map(b=>
 `<div class="tx">${b.type} ${b.amt} DV<br>
 <small>${b.time}<br>Hash:${b.hash}</small></div>`
 ).join("");

 if(users[current].isAdmin){
  let totalUsers=Object.keys(users).length;
  let totalDV=0,rich="",max=0,txCount=0;
  for(let u in users){
   if(!users[u].isAdmin){
    totalDV+=users[u].balance;
    if(users[u].balance>max){max=users[u].balance;rich=u;}
   }
   txCount+=users[u].chain.length;
  }
  stats.innerHTML=`
   <div class="stat"><span>KullanÄ±cÄ±</span><b>${totalUsers}</b></div>
   <div class="stat"><span>Toplam DV</span><b>${totalDV}</b></div>
   <div class="stat"><span>Zengin</span><b>${rich}</b></div>
   <div class="stat"><span>Ä°ÅŸlem</span><b>${txCount}</b></div>
  `;
 }
}

function save(){localStorage.setItem("dv_users",JSON.stringify(users))}
function logout(){location.reload()}
</script>

</body>
</html>
